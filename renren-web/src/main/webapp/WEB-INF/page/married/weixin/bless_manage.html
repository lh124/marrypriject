<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>“码”上结婚</title>
    <link rel="stylesheet" href="${rc.contextPath}/statics/marry/css/weui.min.css"/>
    <link rel="stylesheet" href="${rc.contextPath}/statics/marry/css/marry.css"/>
    <link rel="stylesheet" href="${rc.contextPath}/statics/marry/css/zy.media.min.css"/>
    <script type="text/javascript" src="${rc.contextPath}/statics/marry/js/reset.js"></script>
    <script type="text/javascript" src="${rc.contextPath}/statics/marry/js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="${rc.contextPath}/statics/marry/js/video.min.js"></script>
    <style>
		.m{ position: fixed;top:2rem;width: 7rem;height: 4rem;left:50%;margin-left: -3.5rem;display: none;}
		#my-video{width:100%;height: 100%;}
	</style>
</head>
<script type="text/javascript">
     function init(){
          $.ajax({
				type: "POST",
			    url: "../weixin/me/blessManage",
				dataType: "json",
				success: function(result){
				     if(result.status == 'ok'){
				         var content1 = "";
				         var content2 = "";
				         var content3 = "";
				         for(var i = 0 ; i < result.list.list1.length; i++){
				              if(result.list.list1[i].videoblessing != null && result.list.list1[i].videoblessing != ""){
				              		content1 += '<div class="friend_bless"><dl class="friend_bless_top">'+
				                         '<dt><img src="'+result.list.list1[i].pic+'" /></dt>'+
				                         '<dd>'+result.list.list1[i].nickname+'</dd>'+
				                         '</dl>'+
				                         '<div class="friend_bless_con"><p>'+result.list.list1[i].content+'</p>'+
				                         '<p style="text-align:right;">2017.11.2</p></div></div>';
				               }
				              if(result.list.list1[i].videoblessing != null && result.list.list1[i].videoblessing != ""){
				                   content2 += '<div class="friend_bless"><dl class="friend_bless_top">'+
				                               '<dt><img src="'+result.list.list1[i].pic+'" /></dt>'+
				                               '<dd>'+result.list.list1[i].nickname+'</dd>'+
				                               '<div class="weui-cells_checkbox"><label class="weui-check__label">'+
				                               '<div class="weui-cell__hd"><input type="checkbox" class="weui-check ck" name="checkbox1">'+
				                               '<i class="weui-icon-checked"></i></div></label></div></dl>'+
				                               '<div class="friend_bless_con"><dl class="video">'+
				                               '<dt><img class="videoSrc" title="'+result.list.list1[i].videoblessing+'" src="'+result.list.list1[i].pic+'"></dt>'+
				                               '<dd><p style="text-align:right;">2017.3.4</p></dd></dl></div></div>';
				              }
				         }
				         $("#list1").html(content1);
				         $("#list2").html(content2);
				         var total = 0;
				         for(var i = 0; i < result.list.list2.length; i++){
				              total += parseFloat(result.list.list2[i].content);
				              content3 += '<div class="person_packet"><dl>'+
				                          '<dt><img src="'+result.list.list2[i].pic+'"></dt>'+
				                          '<dd class="weui-flex"><div class="weui-flex__item">'+
				                          '<p>'+result.list.list2[i].nickname+'</p><p>2017.12.25</p>'+
				                          '</div><div class="weui-flex__item person_packet_right">'+
				                          result.list.list2[i].content+'元</div></dd></dl></div>';
				         }
				         $("#list3").append(content3);
				         $("#money").html("￥"+total+"元");
				         $("#total").html(result.list.list2.length);
				     }
				}
		 });
     }
</script>
<body ontouchstart style="background:white;" onload="init()">
	<div class="container" id="container">
		<div class="page" id="pageContainer" style="display:flex;">
			<div class="bless_tit">
                <ul class="weui-flex" id="nav">
                    <li class="weui-flex__item"><span class="active">消息</span></li>
                    <li class="weui-flex__item"><span>视频</span></li>
                    <li class="weui-flex__item"><span>红包</span></li>
                </ul>
            </div>
		</div>
        <div style="margin-top:1.06rem;margin-bottom:1.2rem;">
            <!-- 祝福短信 -->
            <div class="bless_con"id="list1" style="background: url(${rc.contextPath}/statics/marry/img/bless1.png) no-repeat center;background-size: cover;display:block;padding:1rem 0.4rem 2.2rem 0.4rem;">
            </div>
            <!-- 祝福视频 -->
            <div class="m">
				
			</div>
            <div class="bless_con" id="list2">
                
            </div>
            <!-- 祝福红包 -->
            <div class="bless_con" id="list3">
               <dl class="person">
                    <dt><img src="${rc.contextPath}/statics/marry/img/bless_head.png"></dt>
                    <dd>
                        <p style="margin-top:0.2rem;">累计收到<span style="color:#e33a37;" id="total">0</span>个红包</p>
                        <p>共：<span style="font-size:0.6rem;color:#e33a37;" id="money">0元</span></p>
                    </dd>
               </dl>
            </div>
        </div>
	</div>
	<div class="bless_bot weui-tabbar">
        <button id="choice" class="weui-btn weui-btn_primary" style="background:#fe4567;" type="button">祝福选择</button>
    </div>
    <div class="bless_bot weui-tabbar" style="display:none;">
        <button id="sure" class="weui-btn weui-btn_primary" style="background:#fe4567;" type="button">确定选择</button>
    </div>
    <script type="text/javascript">
        $(function(){
            $('#nav li').on("click",function(){
                var index = $(this).prevAll().length;
                $(this).find('span').addClass('active');
                $(this).siblings().find('span').removeClass('active');
                $(".bless_con").hide();
                $(".bless_con").eq(index).show();
            });
			var src="http://www.w3school.com.cn/example/html5/mov_bbb.mp4";
		  	var whereYouAt=0,time=0;
		  	var a=0;
			$(".video").on("click",function(){
				$('#my-video_html5_api').prop('src',src);
		  		var ss = $('my-video');
		  		if(localStorage.getItem('time')){
					time=localStorage.getItem('time');
					localStorage.removeItem('time');
				}
				videojs("my-video").ready(function(){
					var myPlayer = this;
					myPlayer.play();
					myPlayer.currentTime(time);
					myPlayer.on("pause", function(){
					    whereYouAt = myPlayer.currentTime();
					    localStorage.setItem('time',whereYouAt);
					});
					myPlayer.on("ended", function(){
						myPlayer.pause();
						$('.m').hide();
						$('#my-video').hide();
					});
				});
			});
			
			/*祝福选择*/
			$("#choice").on("click",function(){
				$(this).parent().hide();
				$(".weui-cells_checkbox").show();
				$("#sure").parent().show();
			});
			/*确定选择*/
			$("#sure").on("click",function(){
				$(".weui-cells_checkbox").hide();
				var len = $(".ck").length;
				var video = [];
				for(var i=0;i<len;i++){
					if($(".ck").eq(i).prop("checked")==true){
						video.push($(".ck").eq(i).parents(".friend_bless").find(".videoSrc").attr("title"));
					}
				}
				console.log(JSON.stringify(video));
				$.ajax({
				type: "POST",
			    url: "../weixin/me/saveWeddingPhoto?video="+video,
			    dataType: "json",
			    success: function(result){
			       
				}
			});
			});
        });
    </script>
</body>
</html>